#!/bin/bash
set -euo pipefail
BRANCH="${GITHUB_REF_NAME}"
TAG="${GITHUB_REF#refs/tags/}"
echo "üß© Branch: $BRANCH"
echo "üè∑Ô∏è Tag: $TAG"
if [[ ! "$BRANCH" =~ ^release/([a-z0-9\-]+)/([a-z0-9\-]+)$ ]]; then
  echo "‚ùå Invalid branch format. Expected: release/<scope>/<service>"
  exit 1
fi
SCOPE="${BASH_REMATCH[1]}"
SERVICE="${BASH_REMATCH[2]}"
if [[ ! "$TAG" =~ ^([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)$ ]]; then
  echo "‚ùå Invalid tag format. Expected: <stable>.<major>.<minor>.<patch> (e.g. 0.1.2.3)"
  exit 1
fi
VERSION="${BASH_REMATCH[1]}"
{
  echo "scope=$SCOPE"
  echo "service=$SERVICE"
  echo "version=$VERSION"
} >> "$GITHUB_OUTPUT"
